# 宝塔控制台

`bt/` 目录提供宝塔面板的交互式控制台，涵盖全新安装与数据盘迁移等常见场景。脚本均基于 Bash 5 编写，可在大多数主流 Linux 发行版上运行。

## 功能一览

- `./main.sh`：启动控制台菜单，统一调度各任务。
- `tasks/install.sh`：实现“全新安装宝塔面板”流程，支持数据盘自动挂载到 `/www`。
- `tasks/migrate.sh`：数据迁移脚本的占位符，后续将补充详细逻辑。

## 前置要求

1. 使用 root 用户执行，确保对磁盘分区和系统配置拥有足够权限。
2. 推荐提前安装 `parted`、`mkfs.ext4`、`lsblk`、`blkid` 等磁盘相关工具，安装过程中若缺失会提示。
3. 目标环境需能够访问 `https://download.bt.cn/install/install_panel.sh`，以下载官方安装脚本。

## 全新安装流程

1. 运行 `./main.sh` 并选择“全新安装宝塔面板”。
2. 控制台会展示系统信息与磁盘概览，自动识别未挂载的数据盘。
3. 如发现空闲磁盘，可选择是否挂载到 `/www`：
   - 无分区：自动创建 GPT 分区表和 ext4 文件系统后挂载。
   - 已有分区：先提示风险，确认后会清除原分区再重新创建并挂载。
   - `/www` 目录若已有数据，会在挂载前询问是否备份到带时间戳的备份目录。
4. 磁盘挂载成功后，脚本将运行宝塔官方安装命令，输出面板账号信息。

整个流程支持跳过数据盘挂载，若选择跳过则直接执行官方脚本。

## 常用命令

- `bash -n bt/tasks/install.sh`：语法检查。
- `shellcheck bt/tasks/install.sh`：静态分析（需本地已安装 shellcheck）。
- `DEBUG=1 ./main.sh`：以调试模式启动控制台，输出更多日志。

## 后续计划

- 完善数据迁移脚本，涵盖停止服务、移动目录、更新 `fstab` 等细节。
- 为关键流程补充 Bats 单元测试，确保磁盘判定与交互逻辑稳定。

如在使用中遇到问题，欢迎记录操作日志并提出反馈，便于后续迭代。
